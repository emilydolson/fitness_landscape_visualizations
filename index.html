<html>
<head>
	<meta charset="UTF-8">
	<title>Fitness landscapes</title>
    <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>

	<!-- <script src="libraries/aframe-v0.8.0.min.js"></script> -->
	<script src="libraries/stackblur.min.js"></script>
	<script src="libraries/d3.js"></script>
	<script src="libraries/aframe-heatmap3d.js"></script>
	<script src="https://cdn.rawgit.com/tizzle/aframe-orbit-controls-component/master/dist/aframe-orbit-controls-component.min.js"></script>
    <script src="libraries/surface-lines.js"></script>
	<script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
	<script src="libraries/THREE.MeshLine.js"></script>
	<script src="libraries/aframe-meshline-component.js"></script>
	<script src="libraries/aframe-camera-transform-controls-component.min.js"></script>
	
	<style>
		body {
			font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
			line-height: 1.6;
			font-weight: 400;
			font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
		#buttonPanel {
			width:250px;
			position: absolute;
			top: 20px;
			left: 20px;
		}
		.button {
			display: inline-block;
			height: 38px;
			padding: 0 30px;
			color: #555;
			text-align: center;
			font-size: 11px;
			font-weight: 600;
			line-height: 38px;
			letter-spacing: .1rem;
			text-transform: uppercase;
			text-decoration: none;
			white-space: nowrap;
			background-color: transparent;
			border-radius: 4px;
			border: 1px solid #bbb;
			cursor: pointer;
			box-sizing: border-box;
			color: #FFF;
			background-color: #33C3F0;
			border-color: #33C3F0;
			width: 100%;
			margin-top:20px;
		}
		.button:focus {
			color: #FFF;
			background-color: #1EAEDB;
			border-color: #1EAEDB;
		}
		</style>

	<script type=text/javascript>
		var fun4_scales = {"x":d3.scaleLinear().domain([-6, 6]).range([-1.5, 1.5]),
						   "y":d3.scaleLinear().domain([-6, 6]).range([-1.5, 1.5]),
						   "z":d3.scaleLinear().domain([-1986, 199.99998]).range([0, 1])
						  };

		var fun5_scales = {"x":d3.scaleLinear().domain([-1.9, 1.9]).range([-1.5, 1.5]),
						   "y":d3.scaleLinear().domain([-1.1, 1.1]).range([-1.5, 1.5]),
						   "z":d3.scaleLinear().domain([-5.86095, 1.031627]).range([0, 1.01])
						  };

	    var fun6_scales = {"x":d3.scaleLinear().domain([-10, 10]).range([-1.5, 1.5]),
						   "y":d3.scaleLinear().domain([-10, 10]).range([-1.5, 1.5]),
						   "z":d3.scaleLinear().domain([-210.27662470796076, 186.615794955561]).range([0, 1.01])
						  };

	    var fun7_scales = {"x":d3.scaleLinear().domain([.25, 10]).range([-1.5, 1.5]),
						   "y":d3.scaleLinear().domain([.25, 10]).range([-1.5, 1.5]),
						   "z":d3.scaleLinear().domain([-.9999982330513699, 0.999999972963692]).range([0, 1.01])
						  };

	    var fun10_scales = {"x":d3.scaleLinear().domain([0, 1]).range([-1.5, 1.5]),
						    "y":d3.scaleLinear().domain([0, 1]).range([-1.5, 1.5]),
						    "z":d3.scaleLinear().domain([-38.0, -2.0004450187892893]).range([0, 1.01])
						  };

	    var fun11_scales = {"x":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "y":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "z":d3.scaleLinear().domain([-2171.198973635492, -0.002367801442371835]).range([0, 1.01])
						  };

	    var fun12_scales = {"x":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "y":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "z":d3.scaleLinear().domain([-2049.851816104665, -0.016231402532577894]).range([0, 1.01])
						  };

	    var fun13_scales = {"x":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "y":d3.scaleLinear().domain([-5, 5]).range([-1.5, 1.5]),
						    "z":d3.scaleLinear().domain([-3636.8380518041745, -0.0015356224293130573]).range([0, 1.01])
						  };


		var x_scale = fun5_scales.x;
		var y_scale = fun5_scales.y;
		var z_scale = fun5_scales.z;
</script>

	<script type="text/javascript">
		function handleClick(fun_num){
			console.log('Switch to '+fun_num);
			document.getElementById('middle').setAttribute('aframe-heatmap3d', {
				src: '#fun' + fun_num, srcMobile: '#fun' + fun_num});
			d3.select('#basemapEl').transition().attr('src','#fun'+fun_num);
			x_scale = window["fun"+fun_num+"_scales"].x
			y_scale = window["fun"+fun_num+"_scales"].y
			z_scale = window["fun"+fun_num+"_scales"].z
			
			//document.getElementById('basemapEl').setAttribute('src', '#png'+region);
		} // handleClick()
	</script>


</head>
<body>
    <a-scene id="scene" camera-transform-controls="">

		<a-assets>
			<img id="fun4" src="data/fun_4.jpg"  style="display:none"/>
			<img id="fun5" src="data/fun_5.jpg"  style="display:none"/>
			<img id="fun6" src="data/fun_6.jpg"  style="display:none"/>
			<img id="fun7" src="data/fun_7.jpg"  style="display:none"/>
			<img id="fun10" src="data/fun_10.jpg"  style="display:none"/>
			<img id="fun11" src="data/fun_11.jpg"  style="display:none"/>
			<img id="fun12" src="data/fun_12.jpg"  style="display:none"/>
			<img id="fun13" src="data/fun_13.jpg"  style="display:none"/>
		</a-assets>

		<a-entity	
		id="middle"
		aframe-heatmap3d="
		src: #fun5;
		srcMobile: #fun5;
		ignoreZeroValues:false; 
		invertElevation:true;
		palette:parula;
		metalness:.5;
		roughness:0;
		stackBlurRadius:1;		
		stretch:true;
		flipPalette:false; 
		renderMode: surface;
		scaleOpacity: false;
		scaleOpacityMethod:log2;
		opacityMin: 0.99; 
		 width: 3; height: 3;" scale="1 1 1">
		</a-entity>		

		<a-entity
			id="target"
			geometry="primitive: box"
			position="0 0 0"
			material="visible:false">

		</a-entity>

		<a-entity daydream-controls></a-entity>

		<!-- Default lighting injected by A-Frame. -		-->
		<!-- <a-entity light="type: ambient; color: #fff"></a-entity> -->

		<a-entity light="type: directional; target: middle; color: #FFF; intensity: 0.5" position="2 4 5"></a-entity>
		<a-entity light="intensity: 2; distance: 1; angle: 90; target: middle; type:directional" position="5 5 3"></a-entity>

        <a-entity id="cameraRig">
            <!-- camera -->
			<a-entity
			camera="active:true; spectator:true"
			id="camera_orbit"
			position="0 2 3"
			look-controls
			wasd-controls="fly:true"
			orbit-controls="
			autoRotate: false;
			target: #target;
			enableDamping: true;
			dampingFactor: 0.125;
			rotateSpeed:0.15;
			zoomSpeed:0.5;
			maxPolarAngle:1.85;
			minDistance:1;
			maxDistance:10;">
			</a-entity>
            <a-entity id="lefthand" camera-transform-controls-hand="hand:left" vive-controls="hand: left" oculus-touch-controls="hand: left" windows-motion-controls="hand: left"></a-entity>
            <a-entity id="righthand" camera-transform-controls-hand="hand:right" vive-controls="hand: right" oculus-touch-controls="hand: right" windows-motion-controls="hand: right"></a-entity>
        </a-entity>

		<a-entity id="lines">

		</a-entity>
		<!-- <a-entity meshline = "lineWidth:20; path:-0.12 -0.12 -467.724123203, -0.1 -0.1 -496.30454135, -0.0800000000001 -0.0800000000001 -525.143107232,-0.0600000000001 -0.0600000000001 -544.182201207; color:red;" ></a-entity> -->
		<script>
				d3.text("lineage_history_5000854_5.csv", function(error, data){
					if (error) {
						throw error;
					}
					// var scene = d3.select("#scene");
					// scene.selectAll("a-entity")
					// console.log("logging data", data);
					var ssv = d3.dsvFormat(" ");
		
					var points = data.split(",");
					// console.log("ponts:", points);
					// points = points.map(ssv.parse);
					// console.log("ponts:", points, ssv.parse);
					points = points.map(x => {
						x = x.split(" "); 
						return [x_scale(x[0]), z_scale(x[2]), y_scale(x[1])];
					});
		
					
					data_to_bind = [];
					for (var i = 0; i < points.length-1; i++) {
						// var v = ssv.parse(points[i]);
						data_to_bind.push({"start": points[i], "end":points[i+1]});
					}
					// console.log(data_to_bind);
					d3.select("#lines").selectAll("a-entity")
									   .data(data_to_bind)
									   .enter()
									   .append("a-entity")
									   .attr("line", function(d,i){return "start: " + d.start.join(", ") + "; end: " + d.end.join(", ")+"; color: "+d3.hsl(0, 0, i/data_to_bind.length);});
									//    .attr("meshline", "lineWidth:10; color:red; path:"+ data);
				});
				
		
			</script>

	</a-scene>

	<div id="buttonPanel">
		<div class="button" style="top:0px; " onclick="handleClick('4')">Himmelblau</div>
		<div class="button" style="top:150px;"  onclick="handleClick('5')">Six-Hump Camel Back</div>
		<div class="button" style="top:280px;"  onclick="handleClick('6')">Shubert 2D</div>
		<div class="button" style="top:430px;"  onclick="handleClick('7')">Vincent 2D</div>
		<div class="button" style="top:430px;"  onclick="handleClick('10')">Modified Rastrigin</div>
		<div class="button" style="top:580px;"  onclick="handleClick('11')">Composition Function 1</div>
		<div class="button" style="top:730px;"  onclick="handleClick('12')">Composition Function 2</div>
		<div class="button" style="top:880px;"  onclick="handleClick('13')">Composition Function 3</div>

	</div>


</body>

</html>